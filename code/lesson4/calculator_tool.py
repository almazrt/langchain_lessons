import os
from dotenv import load_dotenv
from langchain_openai import ChatOpenAI
from langchain_core.tools import tool

@tool
def calculate_expression(expression: str) -> float:
    """Выполняет математические вычисления. Используйте этот инструмент для решения математических задач.
    
    Args:
        expression: Математическое выражение для вычисления (например, "2 + 3 * 4")
    
    Returns:
        float: Результат вычисления
    """
    try:
        # Безопасное вычисление выражения
        allowed_chars = set('0123456789+-*/(). ')
        if not all(c in allowed_chars for c in expression):
            raise ValueError("Выражение содержит недопустимые символы")
        
        result = eval(expression)
        return float(result)
    except Exception as e:
        return f"Ошибка при вычислении: {str(e)}"

@tool
def get_weather(city: str) -> str:
    """Получает информацию о погоде в указанном городе.
    
    Args:
        city: Название города
        
    Returns:
        str: Информация о погоде
    """
    # В реальном приложении здесь был бы вызов API погоды
    weather_data = {
        "Москва": "Сейчас в Москве солнечно, 22°C",
        "Санкт-Петербург": "В Санкт-Петербурге облачно, 18°C",
        "Новосибирск": "В Новосибирске дождь, 15°C",
        "Екатеринбург": "В Екатеринбурге ясно, 20°C"
    }
    
    return weather_data.get(city, f"Информация о погоде для {city} недоступна")

@tool
def search_wikipedia(query: str) -> str:
    """Выполняет поиск информации в Википедии.
    
    Args:
        query: Поисковый запрос
        
    Returns:
        str: Краткая информация по запросу
    """
    # В реальном приложении здесь был бы вызов API Википедии
    wikipedia_data = {
        "искусственный интеллект": "Искусственный интеллект (ИИ) — это область компьютерных наук, занимающаяся созданием программного обеспечения и алгоритмов, наделяющих компьютеры способностью к обучению, рассуждению и принятию решений.",
        "машинное обучение": "Машинное обучение — это подраздел искусственного интеллекта, который изучает алгоритмы и статистические модели, которые компьютерные системы используют для выполнения задач без явных инструкций.",
        "нейронная сеть": "Нейронная сеть — это вычислительная система, имитирующая работу биологических нейронных сетей головного мозга."
    }
    
    for key, value in wikipedia_data.items():
        if key in query.lower():
            return value
    
    return f"Информация по запросу '{query}' не найдена в Википедии"

def main():
    # Тестирование инструментов
    print("=== Тестирование инструментов ===")
    
    # Тест калькулятора
    result = calculate_expression.invoke("2 + 3 * 4")
    print(f"Результат вычисления '2 + 3 * 4': {result}")
    
    # Тест погоды
    result = get_weather.invoke("Москва")
    print(f"Погода в Москве: {result}")
    
    # Тест Википедии
    result = search_wikipedia.invoke("искусственный интеллект")
    print(f"Информация об ИИ: {result}")

if __name__ == "__main__":
    main()